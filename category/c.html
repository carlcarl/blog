<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>carlcarl's blog - c</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <meta property="og:site_name" content="carlcarl's blog" />
                <meta property="og:type" content="website" />
                <meta property="og:title" content="carlcarl's blog" />
                <meta property="og:url" content="http://blog.carlcarl.me" />
                <meta property="og:description" content="carlcarl's blog" />
            <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/main.css">

    <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/blog.css">
    <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/github.css">
        <link href="http://blog.carlcarl.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="carlcarl's blog Atom Feed" />
        <script src="http://blog.carlcarl.me/theme/js/vendor/modernizr-2.7.1.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
        <h1><a id="site-title" href="http://blog.carlcarl.me"><i class="fa fa-coffee"></i> carlcarl's blog</a></h1>
        <p id="site-desc"></p>
    <nav>
        <ul id="nav-links">
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-05-21T12:00:00+08:00" pubdate>
                            Thu 21 May 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1428/c_coroutine/" rel="bookmark"><h1>C Coroutine</h1></a>
                    </header>
                    <section class="post-content">
                        <h2>Coroutines in C</h2>
<ul>
<li><a href="http://www.chiark.greenend.org.uk/~sgtatham/coroutines.html">http://www.chiark.greenend.org.uk/~sgtatham/coroutines.html</a></li>
</ul>
<h2>怎么理解coroutine ？</h2>
<ul>
<li><a href="http://www.zhihu.com/question/21483863">http://www.zhihu.com/question/21483863</a></li>
</ul>
<h2>libtask</h2>
<ul>
<li><a href="https://github.com/jamwt/libtask">https://github.com/jamwt/libtask</a></li>
</ul>
<h2>protothreads (Use switch; stackless)</h2>
<ul>
<li><a href="http://coolshell.cn/articles/10975.html">http://coolshell.cn/articles/10975.html</a></li>
<li><a href="http://dunkels.com/adam/pt/examples.html#codelock">http://dunkels.com/adam/pt/examples.html#codelock</a></li>
<li><a href="http://www.it165.net/os/html/201503/12134.html">http://www.it165.net/os/html/201503 ...</a></li></ul>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-05-21T11:00:00+08:00" pubdate>
                            Thu 21 May 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1427/c_search_h/" rel="bookmark"><h1>C search.h</h1></a>
                    </header>
                    <section class="post-content">
                        <p>TL;DR: 不要用 search.h 裡的 function.</p>
<p>最近需要改寫別人的程式，裡面有用到 search.h 裡的 function: <code>hsearch</code>，hsearch 其實就是 hash table，搭配其他的一些 function 就可以不用自己實作。但是，這個 hsearch 的缺點卻非常多:</p>
<ol>
<li>hash table 的 size 必須是固定的</li>
<li>沒有 method 可以 traverse 整個 table 的 entry</li>
<li>記憶體管理很麻煩，可能還必須自己再 maintain 一個 linked list 才行</li>
</ol>
<p>這邊是 wiki 上的範例: <a href="http://rosettacode.org/wiki/Associative_arrays/Creation/C#To_delete_or_iterate">http://rosettacode ...</a></p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-04-10T01:00:00+08:00" pubdate>
                            Fri 10 April 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1420/json_c_resources/" rel="bookmark"><h1>JSON-C Resources</h1></a>
                    </header>
                    <section class="post-content">
                        <p>找了一些 JSON-C 的使用範例:</p>
<ul>
<li><a href="blog.yslin.tw/2012/06/json-parser-in-c-language-json-c.html">JSON parser in C language - json-c</a>，簡單 JSON 的 maker 和 parser，不過沒有 array 的例子。</li>
<li><a href="http://www.oknow.co/2014/06/c-json.html">C 語言產生 json 檔</a>，有 array 的例子可以參考。</li>
<li><a href="https://linuxprograms.wordpress.com/category/json-c/">A simple and complete json parser</a>，包含很多例子，可是都會省略掉 free 的動作，要自己記得加。</li>
</ul>
<p>不過最上面兩個都有一個同樣的問題，就是多做了幾次不必要的 free，最後的 <code>json_object_put</code> 其實只要對最上頭的 root 做一次就好，這個 function 會將其中有參照的 object 都做 free ...</p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-04-07T14:00:00+08:00" pubdate>
                            Tue 07 April 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1419/c_cgi_resources/" rel="bookmark"><h1>C CGI Resources</h1></a>
                    </header>
                    <section class="post-content">
                        <p>CGI 的 C 範例，大部分都是很簡單的，找不太到比較完整的資料，只找到 C++ 的，不過還是可以參考看看：<a href="http://www.tutorialspoint.com/cplusplus/cpp_web_programming.htm">http://www.tutorialspoint.com/cplusplus/cpp_web_programming.htm</a>，裡頭有介紹到如何拿 GET, POST 的資料，還有一些常見的 header 欄位。</p>
<p>另外找了一下，怎麼切 cookie 裡的字串比較好，不過也是沒找到比較正統的做法，只看到這種做法：<a href="http://www.gnu-darwin.orgwww.gnu-darwin.org/www001/src/ports/security/zxid/work/zxid-0.22/zxidcdc.c">http://www.gnu-darwin.orgwww.gnu-darwin.org/www001/src/ports/security/zxid/work/zxid-0.22/zxidcdc.c</a>，直接用 <code>strstr</code> 找到想要的欄位這樣。</p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-02-03T20:00:00+08:00" pubdate>
                            Tue 03 February 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1409/c_ppoll_and_pselect/" rel="bookmark"><h1>C ppoll and pselect</h1></a>
                    </header>
                    <section class="post-content">
                        <p>通常 <code>ppoll</code> 和 <code>pselect</code> 會搭配 <code>sigprocmask</code> 使用，先透過 <code>sigprocmask</code> block signal，然後在 <code>ppoll</code> 和 <code>pselect</code> 這邊再 unblock signal 做處理，例如常見的 daemon reload 可以這樣做：</p>
<div class="highlight"><pre><span class="c1">// C</span>
<span class="k">volatile</span> <span class="kt">sig_atomic_t</span> <span class="n">reload_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">terminate_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sig_handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sig</span> <span class="o">==</span> <span class="n">SIGHUP</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">reload_flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sig</span> <span class="o">==</span> <span class="n">SIGTERM</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">terminate_flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// A</span>
<span class="kt">sigset_t</span> <span class="n">mask</span><span class="p">,</span> <span class="n">orig_mask ...</span></pre></div>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-02-03T15:00:00+08:00" pubdate>
                            Tue 03 February 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1408/c_unix_socket/" rel="bookmark"><h1>C UNIX Socket</h1></a>
                    </header>
                    <section class="post-content">
                        <p>可以參考這個連結的 code: <a href="http://kezeodsnx.pixnet.net/blog/post/33616080-unix-domain-socket-">Unix Domain Socket</a>，我後來發現我們 project 裡的 code 也是參考這邊的= =|||，不過的確是還缺少一些東西，像是可以再加上 <code>select</code> 或是 <code>pselect</code> 來另外處理 signal，我自己是用 <code>pselect</code> 就是，有想過用 <code>ppoll</code> 來做，不過實際會聽的連線很少，感覺沒必要就直接用 <code>pselect</code> 了。</p>
<p>修正一下，之後還是改用 <code>ppoll</code> 好了XD，查了一下資料，就算是一個 socket，<code>poll</code> 還是比 <code>select</code> 快～～，參照 <a href="http://www.intelliproject.net/articles/showArticle/index/io_multiplexing">Comparative measurements and analysis of I/O event notification mechanisms</a>。<code>epoll ...</code></p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-02-01T11:30:00+08:00" pubdate>
                            Sun 01 February 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1407/c_sqlite_transaction/" rel="bookmark"><h1>C SQLite Transaction</h1></a>
                    </header>
                    <section class="post-content">
                        <div class="highlight"><pre><span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;BEGIN TRANSACTION;&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

<span class="c1">// if error</span>
<span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;ROLLBACK;&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

<span class="c1">//else</span>
<span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;END TRANSACTION;&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</pre></div>


<p>如果中間發生錯誤，就單做 <code>ROLLBACK</code> 就好, 不需要再做 <code>END TRANSACTION</code>，下面 ref 第二篇裡面的邏輯有點問題，做了 <code>ROLLBACK</code> 然後 <code>break</code> 出去之後又做 <code>COMMIT</code>，怪怪的。</p>
<p>Ref:</p>
<ul>
<li><a href="http://stackoverflow.com/questions/2880149/sqlite-c-cinterface-how-to-commit-a-transaction">SQLITE (C/C++interface) - How to commit a transaction ...</a></li></ul>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-02-01T11:00:00+08:00" pubdate>
                            Sun 01 February 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1406/c_linux_daemon/" rel="bookmark"><h1>C Linux Daemon</h1></a>
                    </header>
                    <section class="post-content">
                        <p>查了一些在 Linux 上怎麼用 C 寫一支 daemon 的做法:</p>
<ul>
<li><a href="http://stackoverflow.com/questions/17954432/creating-a-daemon-in-linux">http://stackoverflow.com/questions/17954432/creating-a-daemon-in-linux</a></li>
<li><a href="http://www.netzmafia.de/skripten/unix/linux-daemon-howto.html">http://www.netzmafia.de/skripten/unix/linux-daemon-howto.html</a></li>
<li><a href="http://shahmirj.com/blog/beginners-guide-to-creating-a-daemon-in-linux">http://shahmirj.com/blog/beginners-guide-to-creating-a-daemon-in-linux</a></li>
<li><a href="http://man7.org/tlpi/code/online/dist/daemons/become_daemon.c.html">http://man7.org/tlpi/code/online/dist/daemons/become_daemon.c.html</a></li>
<li><a href="http://www.freedesktop.org/software/systemd/man/daemon.html">http://www.freedesktop.org/software/systemd/man/daemon.html</a></li>
</ul>
<p>另外就是有建議說: 不要直接 call <code>unistd ...</code></p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-01-30T17:00:00+08:00" pubdate>
                            Fri 30 January 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1405/c_check_type_size_at_compile_time/" rel="bookmark"><h1>Check Type Size at Compile Time in C</h1></a>
                    </header>
                    <section class="post-content">
                        <p>查資料的時候看到的，不過資料裡的方式，宣告 0 陣列還是會過，所以我乾脆多減一：</p>
<div class="highlight"><pre><span class="cp">#define TYPE_SIZE ((sizeof(int) == 4) - 1)</span>
<span class="kt">char</span> <span class="n">arr</span><span class="p">[</span><span class="n">TYPE_SIZE</span><span class="p">];</span>
</pre></div>


<p>完全不確定的話，也可以用 <code>&gt;</code> or <code>&lt;</code> 抓範圍 lol。</p>
<p>Ref:<br />
<a href="http://www.jaggersoft.com/pubs/CVu11_3.html">Compile Time Assertions in C</a></p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2013-08-13T15:50:00+08:00" pubdate>
                            Tue 13 August 2013
                        </time>
                        <a href="http://blog.carlcarl.me/1267/c-define-debug-function/" rel="bookmark"><h1>C define debug function</h1></a>
                    </header>
                    <section class="post-content">
                        <p>參考<a href="http://www.makelinux.net/ldd3/chp-4-sect-2">這篇</a>，然後做了點修改。</p>
<div class="highlight"><pre>#undef CM_DBG
#ifdef LTE_CM_DEBUG
#   define CM_DBG(fmt, args...) do{   
    printf(&quot;  (%d/%s): &quot;fmt, __LINE__, __FILE__, ## args);   
}while(0)
#else
#   define CM_DBG(fmt, args...)
#endif

#undef CM_DBGG
#define CM_DBGG(fmt, args...) do{   
    printf(&quot;  (%d/%s): &quot;fmt, __LINE__, __FILE__, ## args);   
}while(0)
</pre></div>


<p>大致除了命名外還做了點修改：</p>
<ol>
<li>把 <code>printk</code> 的部分拿掉，因為我不需要。</li>
<li><code>CM_DBGG</code> 改成跟原本功能一樣 ...</li></ol>
                    </section>
                </article>
                <hr/>
            </li>
        </ol>
        <div class="paginator">
            Page 1 / 2
                <a href="http://blog.carlcarl.me/category/c2.html">
                    <i class="fa fa-arrow-circle-right"></i>
                </a>
        </div>

    </div>
        </div>

<script>
    var _gaq=[['_setAccount','UA-24249240-5'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
        <script src="http://blog.carlcarl.me/theme/js/main.js"></script>
    </body>
</html>