<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>carlcarl's blog - cloud, linux</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">carlcarl's blog </a></h1>
                <nav><ul>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/690/ubuntu-install-salt-tool/">Ubuntu install salt tool</a></h1>
<footer class="post-info">
        <abbr class="published" title="2012-10-15T20:44:00">
                一 15 10月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="/category/cloud-linux.html">cloud, linux</a>. </p>

</footer><!-- /.post-info --><p>現在有操作多台機器執行同樣指令的需求，想說裝 <a href="http://docs.saltstack.org/en/latest/contents.html">salt</a>
來管理看看，詳細介紹可以點連結進去看看。簡單來講，這套工具可以讓你方便一次去對多個機器進行操作，另外還可以透過用 Python 並 import salt module 來處理整個流程和回傳的資料。<br />
<!--more--><br />
salt 分成了兩個部份，<code>salt-master</code> 和 <code>salt-minion</code> ，<code>salt-master</code>
就是 server 端，也就是你用來管理其他機器的機器上要裝的 (有點饒舌=
=")，minion 則是 client 端，就是被管理的機器所要裝的套件。server
端會開個 service 讓 client 連，所以 client 端必須能夠知道 server 端的 IP
或者是 host name ，client 端連上來後，server 端可以決定是否接受這個
client 端的要求，接受的話，之後就能夠管理這個 client
。以下是兩邊所要裝的套件流程:</p>
<p>salt-master:</p>
<div class="highlight"><pre>sudo apt-get install python-software-properties
sudo add-apt-repository ppa:saltstack/salt
sudo apt-get update
sudo apt-get install salt-master
</pre></div>


<p>salt-minion:</p>
<div class="highlight"><pre>sudo apt-get install python-software-properties
sudo add-apt-repository ppa:saltstack/salt
sudo apt-get update
sudo apt-get install salt-minion
</pre></div>


<p>master 這邊裝好後，如果你的 master 有多個 IP
(如果沒有的話，可以跳過這步），可以選擇你要用哪個 IP 來 listen，修改
<code>/etc/salt/master</code></p>
<div class="highlight"><pre>interface: 改成你 master 要 listen 的 IP
</pre></div>


<p>修改完後，重啟 service:</p>
<div class="highlight"><pre>sudo /etc/init.d/salt-master restart
</pre></div>


<p>minion 這邊則要修改 <code>/etc/salt/minion</code></p>
<div class="highlight"><pre>master: master 的 IP 或者是 host name
</pre></div>


<p>修改完後，重啟 service:</p>
<div class="highlight"><pre>sudo /etc/init.d/salt-minion restart
</pre></div>


<p>安裝好之後，接下來要在 master 這邊加入 minion 這邊的機器，執行</p>
<div class="highlight"><pre>sudo salt-key -L
</pre></div>


<p>應該能夠看到 minion 端的 host name ，接著執行:</p>
<div class="highlight"><pre>sudo salt-key -a &lt;minon_hostname&gt;
</pre></div>


<p>就可以將這台機器納入管理中了。<br />
<br />
設定完後，可以輸入下面指令做測試，回傳 True 的話就表示 OK 啦</p>
<div class="highlight"><pre>sudo salt * test.ping
</pre></div>


<p>參考網址：<br />
<a href="http://docs.saltstack.org/en/latest/topics/installation/ubuntu.html">http://docs.saltstack.org/en/latest/topics/installation/ubuntu.html</a><br />
<a href="http://docs.saltstack.org/en/latest/topics/tutorials/modules.html">http://docs.saltstack.org/en/latest/topics/tutorials/modules.html</a></p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/519/vm-template-cant-specify-hostname/" rel="bookmark"
                           title="Permalink to VM template can't specify hostname">VM template can't specify hostname</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-06-18T18:07:00">
                一 18 6月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="/category/cloud-linux.html">cloud, linux</a>. </p>
<p>tags: <a href="/tag/hostname.html">hostname</a><a href="/tag/template.html">template</a></p>
</footer><!-- /.post-info -->                <p>這個應該很多 hypervisor 都適用，在做完 vm 的 template 之後，因為
hostname 在這裡已經固定，所以利用這個 template 再開啟一個新的 instance
的時候，hostname 會還是原本舊的，如果是用 DHCP
的方式的話，照理來說是可以拿到當初指定的 hostname 的。<br />
<!--more--><br />
這邊我找了很多資料，本來從 hypervisor
這邊去找資料，不過都沒什麼結果，後來才發現原來從 Guest OS 這邊去修改就
OK 了，方法很簡單，在你的 VM 裡執行：</p>
<div class="highlight"><pre>sudo mv /etc/hostname /etc/hostname.old
</pre></div>


<p>然後重開 VM，這樣就會根據 DHCP ...</p>
                <a class="readmore" href="/519/vm-template-cant-specify-hostname/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/262/xenserver-enable-snmpd/" rel="bookmark"
                           title="Permalink to xenserver enable snmpd">xenserver enable snmpd</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-02-19T16:06:00">
                日 19 2月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="/category/cloud-linux.html">cloud, linux</a>. </p>
<p>tags: <a href="/tag/iptables.html">iptables</a><a href="/tag/snmp.html">snmp</a><a href="/tag/snmpd.html">snmpd</a><a href="/tag/xenserver.html">xenserver</a></p>
</footer><!-- /.post-info -->                <p>我用的 xenserver 版本為「5.6」，6 以上的版本就不能確定能否這樣做囉。</p>
<h3>首先要先修改防火牆規則</h3>
<p>xenserver 雖然本身就有 snmpd 了，不過只單純打開 snmpd 是沒用的，會被防火牆擋下。用 vi
    編輯 <code>/etc/sysconfig/iptables</code>，找到 <code>-A RH-Firewall-1-INPUT –p udp
    –dport 5353</code> 這行：</p>
<div class="highlight"><pre>-A RH-Firewall-1-INPUT -p ah -j ACCEPT
-A RH-Firewall-1-INPUT -d 224.0.0.251 -p udp -m udp --dport 5353 -j ...</pre></div>
                <a class="readmore" href="/262/xenserver-enable-snmpd/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>