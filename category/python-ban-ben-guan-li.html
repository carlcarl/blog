<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>carlcarl's blog - python, 版本管理</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">carlcarl's blog </a></h1>
                <nav><ul>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/1365/sphinx-and-github-pages/">sphinx and github pages</a></h1>
<footer class="post-info">
        <abbr class="published" title="2013-10-04T21:26:00">
                五 04 10月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="/category/python-ban-ben-guan-li.html">python, 版本管理</a>. </p>
<p>tags: <a href="/tag/github.html">github</a><a href="/tag/sphinx.html">sphinx</a></p>
</footer><!-- /.post-info --><p>就之前產生的 sphinx document，接下來是如何 deploy 到 github page 上。</p>
<p>這個文章是根據 <a href="http://raxcloud.blogspot.tw/2013/02/documenting-python-code-using-sphinx.html">Documenting python code using sphinx and github</a> 和
<a href="http://datadesk.latimes.com/posts/2012/01/sphinx-on-github/">Sphinx documentation on GitHub</a>
整理而成的，兩個地方的資料都不錯，不過都沒有很完美，所以就寫了這篇。</p>
<!--more-->

<h2>建立 github page repo</h2>
<p>這邊看到大部分的做法都是直接在 project 根目錄下直接開另外一個
branch，不過我後來在上面連結看到一個不錯的做法，就是直接把 branch 建立在
subdirectory 下。首先先在 project 根目錄下建立一個 gh-pages 的資料夾：</p>
<div class="highlight"><pre>mkdir gh-pages
</pre></div>


<p>接著利用 <code>git-new-workdir</code> 這個指令建立一個 subdirectory，這個指令一般在
<code>/usr/local/share/git-core/contrib/workdir/git-new-workdir</code>，在 Mac
下需要另外用 <code>brew</code> 裝 <code>git</code>，位置會放在
<code>/usr/local/Cellar/git/1.8.4/share/git-core/contrib/workdir/git-new-workdir</code>，<code>1.8.4</code>
要換成你現在的 git 版本，至於 Xcode 本身雖然也有裝
git，但是我就找不到它的 <code>git-new-workdir</code> 在哪了，然後可以自己建個 link
來用：</p>
<div class="highlight"><pre>sudo ln -s /usr/local/Cellar/git/1.8.4/share/git-core/contrib/workdir/git-new-workdir /usr/local/bin/git-new-workdir
</pre></div>


<p>然後繼續下面的步驟：</p>
<div class="highlight"><pre>git-new-workdir . gh-pages/html
</pre></div>


<p>接著進入資料夾並 checkout 一個新的 branch：</p>
<div class="highlight"><pre><span class="nb">cd </span>gh-pages/html
git checkout --orphan gh-pages
</pre></div>


<p>將裡面的東西都清光光：</p>
<div class="highlight"><pre>git rm -rf .
</pre></div>


<h2>產生 sphinx document</h2>
<p>回到 project 根目錄下的 doc 下：</p>
<div class="highlight"><pre><span class="nb">cd</span> ../../doc/
</pre></div>


<p>修改 Makefile：</p>
<div class="highlight"><pre><span class="nv">BUILDDIR</span>      <span class="o">=</span> _build
</pre></div>


<p>改成</p>
<div class="highlight"><pre><span class="nv">BUILDDIR</span>      <span class="o">=</span> ../gh-pages/html
</pre></div>


<p>這樣所有的輸出都會在 <code>gh-pages/html/</code> 底下。但是這樣 sphinx 的 html
變成會在 <code>gh-pages/html/</code> 底下再建一個 <code>html</code> 資料夾，所以 Makefile
還有一個地方要改：</p>
<div class="highlight"><pre><span class="nf">html</span><span class="o">:</span>
<span class="k">$(</span>SPHINXBUILD<span class="k">)</span> -b html <span class="k">$(</span>ALLSPHINXOPTS<span class="k">)</span> <span class="k">$(</span>BUILDDIR<span class="k">)</span>/html
@echo
@echo <span class="s2">&quot;Build finished. The HTML pages are in $(BUILDDIR)/html.&quot;</span>
</pre></div>


<p>改成</p>
<div class="highlight"><pre><span class="nf">html</span><span class="o">:</span>
<span class="k">$(</span>SPHINXBUILD<span class="k">)</span> -b html <span class="k">$(</span>ALLSPHINXOPTS<span class="k">)</span> <span class="k">$(</span>BUILDDIR<span class="k">)</span>
@echo
@echo <span class="s2">&quot;Build finished. The HTML pages are in $(BUILDDIR).&quot;</span>
</pre></div>


<p>這樣它就會把 html 的部分直接輸出到 <code>gh-pages/html/</code> 底下，接著輸入
<code>Make html</code> 產生網頁。</p>
<h2>github page push</h2>
<p>先移到 gh-pages/html 下：</p>
<div class="highlight"><pre><span class="nb">cd</span> ../gh-pages/html
</pre></div>


<p>這邊還有一個地方要注意，那就是 github 預設的 site 架構 (Jekyll)，會忽略
<code>_</code> 開頭的資料夾，所以要用個檔案來告訴 github 不要用這種架構：</p>
<div class="highlight"><pre>touch .nojekyll
</pre></div>


<p>接著加入所有檔案到 git 中， commit 並 push 上去就完成了：</p>
<div class="highlight"><pre>git add .
git commit -m <span class="s2">&quot;First commit&quot;</span>
git push -u origin gh-pages
</pre></div>


<h2>參考資料</h2>
<p><a href="https://github.com/blog/572-bypassing-jekyll-on-github-pages">Bypassing Jekyll on GitHub Pages</a><br />
<a href="http://nuclearsquid.com/writings/git-new-workdir/">git-new-workdir</a><br />
<a href="http://subtech.g.hatena.ne.jp/secondlife/20121207/1354854068">git-new-workdir が便利</a></p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>