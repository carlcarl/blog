<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Python Sphinx simple example
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <meta property="og:site_name" content="carlcarl's blog" />
                <meta property="og:type" content="article" />
                <meta property="og:title" content="Python Sphinx simple example" />
                <meta property="og:url" content="http://blog.carlcarl.me/1331/python-sphinx-simple-example/" />
                <meta property="og:description" content="查了很多資料，遇到一堆鬼打牆問題，終於弄成我要的樣子了，不過其實也沒有加多少東西，只是基本的設定一直搞不定 orz。 下面是一開始的 project 結構，接著會利用 sphinx 在根目錄下建立 doc 這個目錄： Project 目錄架構 . ├── CHANGES.txt ├── MANIFEST.in ├── README.rst ├── test │ ├── __init__.py │ └── test.py ├── requirements.txt └── setup.py 安裝並產生設定 首先先安裝 sphinx(ex: pip install sphinx)，接著在 project 根目錄下輸入 sphinx-quickstart，設定步驟如下： Welcome to the Sphinx 1.1.3 ..." />
                    <meta property="article:tag" content="python" />
                    <meta property="article:tag" content="sphinx" />
            <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/main.css">

    <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/blog.css">
    <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/github.css">
        <link href="http://blog.carlcarl.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="carlcarl's blog Atom Feed" />
        <script src="http://blog.carlcarl.me/theme/js/vendor/modernizr-2.7.1.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
        <h1><a id="site-title" href="http://blog.carlcarl.me"><i class="fa fa-coffee"></i> carlcarl's blog</a></h1>
        <p id="site-desc"></p>
    <nav>
        <ul id="nav-links">
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2013-10-02T02:32:00+08:00" pubdate>
                            Wed 02 October 2013
                        </time>
                        <a href="http://blog.carlcarl.me/1331/python-sphinx-simple-example/" rel="bookmark"><h1>Python Sphinx simple example</h1></a>
                    </header>

                    <section class="post-content">
                        <p>查了很多資料，遇到一堆鬼打牆問題，終於弄成我要的樣子了，不過其實也沒有加多少東西，只是基本的設定一直搞不定
orz。</p>
<hr />
<p>下面是一開始的 project 結構，接著會利用 <code>sphinx</code> 在根目錄下建立 <code>doc</code>
這個目錄：</p>
<h2>Project 目錄架構</h2>
<div class="highlight"><pre>.
├── CHANGES.txt
├── MANIFEST.in
├── README.rst
├── test
│   ├── __init__.py
│   └── test.py
├── requirements.txt
└── setup.py
</pre></div>


<hr />
<h2>安裝並產生設定</h2>
<p>首先先安裝 <code>sphinx</code>(ex: <code>pip install sphinx</code>)，接著在 project
根目錄下輸入 <code>sphinx-quickstart</code>，設定步驟如下：</p>
<div class="highlight"><pre>Welcome to the Sphinx 1.1.3 quickstart utility.

Please enter values for the following settings (just press Enter to
accept a default value, if one is given in brackets).

Enter the root path for documentation.
&gt; Root path for the documentation [.]: doc

You have two options for placing the build directory for Sphinx output.
Either, you use a directory &quot;_build&quot; within the root path, or you separate
&quot;source&quot; and &quot;build&quot; directories within the root path.
&gt; Separate source and build directories (y/N) [n]:

Inside the root directory, two more directories will be created; &quot;_templates&quot;
for custom HTML templates and &quot;_static&quot; for custom stylesheets and other static
files. You can enter another prefix (such as &quot;.&quot;) to replace the underscore.
&gt; Name prefix for templates and static dir [_]:

The project name will occur in several places in the built documentation.
&gt; Project name: test
&gt; Author name(s): carlcarl

Sphinx has the notion of a &quot;version&quot; and a &quot;release&quot; for the
software. Each version can have multiple releases. For example, for
Python the version is something like 2.5 or 3.0, while the release is
something like 2.5.1 or 3.0a1.  If you don&#39;t need this dual structure,
just set both to the same value.
&gt; Project version: 0.0.1
&gt; Project release [0.0.1]:

The file name suffix for source files. Commonly, this is either &quot;.txt&quot;
or &quot;.rst&quot;.  Only files with this suffix are considered documents.
&gt; Source file suffix [.rst]:

One document is special in that it is considered the top node of the
&quot;contents tree&quot;, that is, it is the root of the hierarchical structure
of the documents. Normally, this is &quot;index&quot;, but if your &quot;index&quot;
document is a custom template, you can also set this to another filename.
&gt; Name of your master document (without suffix) [index]:

Sphinx can also add configuration for epub output:
&gt; Do you want to use the epub builder (y/N) [n]:

Please indicate if you want to use one of the following Sphinx extensions:
&gt; autodoc: automatically insert docstrings from modules (y/N) [n]: y
&gt; doctest: automatically test code snippets in doctest blocks (y/N) [n]:
&gt; intersphinx: link between Sphinx documentation of different projects (y/N) [n]:
&gt; todo: write &quot;todo&quot; entries that can be shown or hidden on build (y/N) [n]:
&gt; coverage: checks for documentation coverage (y/N) [n]:
&gt; pngmath: include math, rendered as PNG images (y/N) [n]:
&gt; mathjax: include math, rendered in the browser by MathJax (y/N) [n]:
&gt; ifconfig: conditional inclusion of content based on config values (y/N) [n]:
&gt; viewcode: include links to the source code of documented Python objects (y/N) [n]:

A Makefile and a Windows command file can be generated for you so that you
only have to run e.g. `make html&#39; instead of invoking sphinx-build
directly.
&gt; Create Makefile? (Y/n) [y]:
&gt; Create Windows command file? (Y/n) [y]: n

Creating file doc/conf.py.
Creating file doc/index.rst.
Creating file doc/Makefile.

Finished: An initial directory structure has been created.

You should now populate your master file doc/index.rst and create other documentation
source files. Use the Makefile to build the docs, like so:
   make builder
where &quot;builder&quot; is one of the supported builders, e.g. html, latex or linkcheck.
</pre></div>


<p>比較要注意的是一開始的路徑輸入 <code>doc</code> 表示要在當前目錄的 <code>doc</code>
底下建立文件。 <code>autodoc</code> 這個記得選 <code>y</code>。因為不是用 Windows，所以
<code>Windows command file</code> 這個選項我就選 <code>n</code> 了。輸入完後會建立 <code>doc</code>
這個目錄。</p>
<hr />
<h2>產生 API 設定文件</h2>
<p>在 project 根目錄下輸入：<code>sphinx-apidoc -o doc/api test</code>，會將 API
設定文件放到 <code>doc/api</code> 底下。</p>
<hr />
<h2>修改設定檔</h2>
<p>接著進入 <code>doc</code> 這個目錄 (<code>cd doc</code>)，修改 <code>index.rst</code> 以及 <code>conf.py</code>。</p>
<h3>conf.py</h3>
<p>首先是 <code>conf.py</code>。在 <code>import sys, os</code> 下面加上
<code>sys.path.insert(0, os.path.abspath('..'))</code> 即可，這邊是將 project 的
path 加入 <code>sys.path</code> 當中，不然 sphinx 會找不到。</p>
<h3>index.rst</h3>
<p>這邊是我整個設定檔：</p>
<div class="highlight"><pre><span class="cp">.. test documentation master file, created by</span>
<span class="cp">   sphinx-quickstart on Wed Oct  2 00:41:51 2013.</span>
<span class="cp">   You can adapt this file completely to your liking, but it should at least</span>
<span class="cp">   contain the root `toctree` directive.</span>

<span class="gh">Welcome to test&#39;s documentation!</span>
<span class="gh">======================================</span>

<span class="na">:doc:</span><span class="nv">`API Documentation &lt;api/test&gt;`</span>

<span class="p">..</span> <span class="ow">include</span><span class="p">::</span> ../README.rst


<span class="gh">Indices and tables</span>
<span class="gh">==================</span>

<span class="m">*</span> <span class="na">:ref:</span><span class="nv">`genindex`</span>
<span class="m">*</span> <span class="na">:ref:</span><span class="nv">`modindex`</span>
<span class="m">*</span> <span class="na">:ref:</span><span class="nv">`search`</span>

<span class="p">..</span> <span class="ow">toctree</span><span class="p">::</span>
   <span class="nc">:hidden:</span>

   api/modules
</pre></div>


<p><code>API Documentation</code> 這段是程式的 API 連結。如果在 project 根目錄有
<code>README.rst</code> 的話，可以如上面這樣 include 進來。最下面的 <code>toctree</code> 到
<code>api/modules</code> 這段是因為 <code>sphinx-apidoc</code> 會產生一個 <code>modules.rst</code>
檔案，如果沒加到 <code>toctree</code> 會有警告，這邊就把它加進來，然後設隱藏，至於
<code>toctree</code> 是啥，可以參考 <a href="http://sphinx-doc.org/concepts.html">這個連結</a>，算是一個目錄架構這樣。</p>
<hr />
<h2>產生 html</h2>
<p>在 <code>doc</code> 底下輸入 <code>make html</code>，產生的 html 會放在 <code>_build/html</code>
下，到這裡就算大功告成了。</p>
<hr />
<h2>其他遇到的問題</h2>
<h3>為啥不在 rst 檔案中加入 automodule 的設定，而是用 <code>sphinx-apidoc</code> 產生 API 文件？</h3>
<p>因為 automodule 做不到 recursive 尋找 submodule。相關討論連結如下：</p>
<p><a href="http://stackoverflow.com/questions/4616693/automatically-generating-documentation-for-all-python-package-contents">Automatically Generating Documentation for All Python Package Contents</a><br />
<a href="http://stackoverflow.com/questions/2701998/sphinx-autodoc-is-not-automatic-enough">Sphinx autodoc is not automatic enough</a><br />
<a href="http://stackoverflow.com/questions/11508290/sphinx-using-automodule-to-find-submodules">Sphinx, using automodule to find submodules</a></p>
<h3>sphinx-build option -b not recognized</h3>
<p>這個錯誤的直接原因是因為 module 裡面有用 <code>argparse</code> 這類的 module，然後
<code>sphinx-build</code> 執行時有 <code>-b</code> 這個參數，傳進去之後就炸了。但是一般來說
module 裡用 <code>argparse</code>，本身不是個問題，問題是 sphinx
為啥執行了這段程式，有幾個可能的原因：</p>
<ol>
<li>module 裡沒用 <code>if __name__ == '__main__':</code> 這段，而是直接執行。</li>
<li>sphix-apidoc 讀取的目錄裡包含 <code>setup.py</code>，即使 module
    裡有用上面的判斷包起來，還是會全執行。</li>
</ol>
<p>所以我一開始才會用 <code>sphinx-apidoc -o doc/api test</code> 而不是
<code>sphinx-apidoc -o doc/api .</code>，就是要避開
<code>setup.py</code>。下面是找到的相關連結：</p>
<p><a href="http://stackoverflow.com/questions/6912025/is-optionparser-in-conflict-with-sphinx">Is OptionParser in conflict with sphinx?</a><br />
<a href="http://stackoverflow.com/questions/14769962/how-should-i-solve-the-conflict-of-optionparser-and-sphinx-build-in-a-large-proj">How should I solve the conflict of OptionParser and sphinx-build in a large project?</a><br />
<a href="http://www.mail-archive./om/sphinx-dev@googlegroups.com/msg05521.html">Re: sphinx-dev option -b not recognized?</a></p>
<h3>WARNING: document isn't included in any toctree</h3>
<p>參閱 <a href="http://stackoverflow.com/questions/1690757/location-of-sphinx-sources-for-my-notes">Location of Sphinx sources for my notes</a></p>
<hr />
<h2>參考資料</h2>
<p><a href="http://raxcloud.blogspot.tw/2013/02/documenting-python-code-using-sphinx.html">Documenting python code using sphinx and github</a><br />
<a href="http://stackoverflow.com/questions/10324393/sphinx-build-fail-autodoc-cant-import-find-module">sphinx-build fail - autodoc can't import/find module</a><br />
<a href="http://scienceoss.com/minimal-sphinx-setup-for-autodocumenting-python-modules/">http://scienceoss.com/minimal-sphinx-setup-for-autodocumenting-python-modules/</a><br />
<a href="http://api.mongodb.org/python/current/">Example: PyMongo documentation</a></p>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="http://blog.carlcarl.me/category/python.html">python</a></p>
                        <p>Tags: <a href="http://blog.carlcarl.me/tag/python.html">python</a>, <a href="http://blog.carlcarl.me/tag/sphinx.html">sphinx</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'carlcarl';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

<script>
    var _gaq=[['_setAccount','UA-24249240-5'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
        <script src="http://blog.carlcarl.me/theme/js/main.js"></script>
    </body>
</html>