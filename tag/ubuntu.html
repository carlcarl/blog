<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>carlcarl's blog - ubuntu</title>
        <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://blog.carlcarl.me/">carlcarl's blog </a></h1>
                <nav><ul>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://blog.carlcarl.me/879/ubuntu-nginx-pagespeed-module/">Ubuntu nginx pagespeed module</a></h1>
<footer class="post-info">
        <abbr class="published" title="2013-06-03T21:25:00">
                一 03 6月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.carlcarl.me/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="http://blog.carlcarl.me/category/linux.html">linux</a>. </p>
<p>tags: <a href="http://blog.carlcarl.me/tag/nginx.html">nginx</a><a href="http://blog.carlcarl.me/tag/pagespeed.html">pagespeed</a><a href="http://blog.carlcarl.me/tag/ubuntu.html">ubuntu</a></p>
</footer><!-- /.post-info --><p>Ubuntu 版本：12.04 Nginx 版本：1.4.1 pagespeed 版本：1.5.27.3
記錄一下安裝的步驟： <!--more--></p>
<div class="highlight"><pre><span class="c"># 到 home 目錄下做，看個人習慣就是</span>
<span class="nb">cd</span> ~
<span class="c"># add-apt-repository 這個指令需要裝 python-software-properties</span>
sudo apt-get install python-software-properties
sudo add-apt-repository ppa:nginx/stable
sudo apt-get update
<span class="c"># 下載 nginx source code</span>
sudo apt-get <span class="nb">source </span>nginx
<span class="c"># 裝 build nginx 需要的套件</span>
sudo apt-get build-dep nginx
<span class="c"># 裝 pagespeed 需要的套件</span>
sudo apt-get install build-essential zlib1g-dev libpcre3 libpcre3-dev

<span class="c"># 下載 pagespeed</span>
wget https://github.com/pagespeed/ngx_pagespeed/archive/release-1.5.27.3-beta.zip
unzip release-1.5.27.3-beta.zip
<span class="nb">cd </span>ngx_pagespeed-release-1.5.27.3-beta/
wget https://dl.google.com/dl/page-speed/psol/1.5.27.3.tar.gz
tar -xzvf 1.5.27.3.tar.gz
 
<span class="nb">cd</span> ~/nginx-1.4.1/
<span class="c"># 我會需要用到 https，所以加上 --with-http_ssl_module</span>
./configure --add-module<span class="o">=</span><span class="nv">$HOME</span>/ngx_pagespeed-release-1.5.27.3-beta --with-http_ssl_module
make
sudo make install
 
<span class="c"># 建個 link。也可以 link 到別的位置，不過記得下面 init sctipt 中的 DAEMON 的位置要跟著改</span>
sudo ln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/nginx
</pre></div>


<p>如果在之前有裝過 nginx 的話，在 <code>/etc/init.d/</code> 底下應該有個 nginx 的
init script，我是直接用這個，不過還要加點修改：</p>
<div class="highlight"><pre><span class="cp"># DAEMON 改成這樣</span>
<span class="n">DAEMON</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nginx</span>
</pre></div>


<p>接著修改 <code>/usr/local/nginx/conf/nginx.conf</code>：（這邊是因為我在 configure
的時候沒有另外指定位置，所以在這裡）</p>
<div class="highlight"><pre># pid 改成這樣，以對應到 init script 中的設定，不然不能 restart 和 stop
pid /var/run/nginx.pid;
...
http {
    # 加上這兩行以啟用 pagespeed
    pagespeed on;
    pagespeed FileCachePath /var/ngx_pagespeed_cache;
...
}
</pre></div>


<p>接著編輯每個 virtualhost 的 conf：</p>
<div class="highlight"><pre>server {
...
    # 加上以下幾行
    location ~ &quot;\.pagespeed\.([a-z]\.)?[a-z]{2}\.[^.]{10}\.[^.]+&quot; { add_header &quot;&quot; &quot;&quot;; }
    location ~ &quot;^/ngx_pagespeed_static/&quot; { }
    location ~ &quot;^/ngx_pagespeed_beacon$&quot; { }
    location /ngx_pagespeed_statistics { allow 127.0.0.1; deny all; }
    location /ngx_pagespeed_message { allow 127.0.0.1; deny all; }
...
}
...
</pre></div>


<p>新增 <code>/var/ngx_pagespeed_cache</code> 這個資料夾，並讓 nginx
有寫入的權限。這個資料夾是讓 pagespeed 放 cache 用的，視情況可以考慮放在
<code>/dev/shm/</code> 底下加快速度，不過我自己是還沒試過就是 :P。這邊我的 nginx
是用 <code>www-data</code>，如以下操作：</p>
<div class="highlight"><pre>sudo mkdir /var/ngx_pagespeed_cache
sudo chown www-data:www-data /var/ngx_pagespeed_cache
</pre></div>


<p>啟動 nginx:</p>
<div class="highlight"><pre>sudo service nginx start
</pre></div>


<p>接著放個網頁並試試看以下指令，有的話就代表成功了</p>
<div class="highlight"><pre>curl -I -p 你的網址 | grep X-Page-Speed
</pre></div>


<p>以上是基本的安裝，pagespeed
還有提供很多設定，要指定才會有效，之後有空再另外寫一篇補完。</p>
<p>參考網址：<br />
<a href="https://github.com/pagespeed/ngx_pagespeed">https://github.com/pagespeed/ngx_pagespeed</a><br />
<a href="http://serverfault.com/questions/502764/how-to-build-nginx-1-4-0-and-ngx-pagespeed-in-ubuntu-debian">http://serverfault.com/questions/502764/how-to-build-nginx-1-4-0-and-ngx-pagespeed-in-ubuntu-debian</a>
<a href="http://serverfault.com/questions/180808/how-to-get-latest-nginx-using-apt-ubuntu">http://serverfault.com/questions/180808/how-to-get-latest-nginx-using-apt-ubuntu</a>
<a href="https://www.digitalocean.com/community/articles/how-to-install-the-latest-version-of-nginx-on-ubuntu-12-10">https://www.digitalocean.com/community/articles/how-to-install-the-latest-version-of-nginx-on-ubuntu-12-10</a>
<a href="http://blog.linuxeye.com/318.html">http://blog.linuxeye.com/318.html</a></p><p>There are <a href="http://blog.carlcarl.me/879/ubuntu-nginx-pagespeed-module/#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://blog.carlcarl.me/873/ubuntu-service-cant-restart-or-stop/" rel="bookmark"
                           title="Permalink to Ubuntu service can't restart or stop">Ubuntu service can't restart or stop</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-06-03T11:48:00">
                一 03 6月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.carlcarl.me/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="http://blog.carlcarl.me/category/linux.html">linux</a>. </p>
<p>tags: <a href="http://blog.carlcarl.me/tag/nginx.html">nginx</a><a href="http://blog.carlcarl.me/tag/ubuntu.html">ubuntu</a></p>
</footer><!-- /.post-info -->                <p>在自己編 nginx 的時候遇到的小問題，因為自己裝的 conf 設定和原本 Ubuntu
repo 裡的的不一樣，然後 init script 我是用 repo 裡提供的。</p>
<p>看了一下 repo 提供的 init script，似乎是因為找不到 start service 所建立的
pid 檔案，google 了一下，在 stackoverflow
找到 <a href="http://stackoverflow.com/questions/10939072/add-nginx-as-a-ubuntu-service-stop-and-reload-doesnt-work">這篇問題</a> 剛好和我遇到的情況一樣，check 了一下 nginx conf 裡的 pid
檔案位置和 init script 裡的 pid
檔案位置，發現設定並不一樣，改成一樣後，問題就解決了～～。</p>
                <a class="readmore" href="http://blog.carlcarl.me/873/ubuntu-service-cant-restart-or-stop/">read more</a>
<p>There are <a href="http://blog.carlcarl.me/873/ubuntu-service-cant-restart-or-stop/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://blog.carlcarl.me/397/ubuntu-tunnel-broker/" rel="bookmark"
                           title="Permalink to Ubuntu Tunnel Broker IPv6 連 中研院">Ubuntu Tunnel Broker IPv6 連 中研院</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-05-04T16:36:00">
                五 04 5月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.carlcarl.me/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="http://blog.carlcarl.me/category/linux.html">linux</a>. </p>
<p>tags: <a href="http://blog.carlcarl.me/tag/ipv6.html">ipv6</a><a href="http://blog.carlcarl.me/tag/tunnel-broker.html">tunnel broker</a><a href="http://blog.carlcarl.me/tag/ubuntu.html">ubuntu</a></p>
</footer><!-- /.post-info -->                <p>最近看到有人用 <a href="http://planykao.blogspot.com/2012/04/archlinux-ipv6-tunnel-broker.html">Archlinux 設定 Tunnel Broker
的方法</a>，所以研究了一下該怎麼用，發現還滿簡單的0.0。</p>
<h3>申請帳號</h3>
<p>到 <a href="http://tb2.ipv6.ascc.net/">http://tb2.ipv6.ascc.net/</a> 註冊一個帳號。</p>
<h3>安裝 gogoc</h3>
<div class="highlight"><pre>sudo apt-get install gogoc
</pre></div>


<h3>設定 gogoc (<code>/etc/gogoc/gogoc.conf</code>)</h3>
<p><code>if_prefix</code> 要看你的網卡裝置名稱叫啥，不過預設應該都是 eth0。</p>
<div class="highlight"><pre>userid=你的帳號
passwd=你的密碼
server=tb2.ipv6.ascc.net
auth_method=digest-md5
host_type=host
prefixlen=64
if_prefix=eth0 ...</pre></div>
                <a class="readmore" href="http://blog.carlcarl.me/397/ubuntu-tunnel-broker/">read more</a>
<p>There are <a href="http://blog.carlcarl.me/397/ubuntu-tunnel-broker/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://blog.carlcarl.me/326/ubuntu-desktop-record-recorditnow-ffmpeg/" rel="bookmark"
                           title="Permalink to Ubuntu desktop record: recorditnow+ffmpeg">Ubuntu desktop record: recorditnow+ffmpeg</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-03-29T02:13:00">
                四 29 3月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.carlcarl.me/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="http://blog.carlcarl.me/category/linux.html">linux</a>. </p>
<p>tags: <a href="http://blog.carlcarl.me/tag/ffmpeg.html">ffmpeg</a><a href="http://blog.carlcarl.me/tag/recorditnow.html">recorditnow</a><a href="http://blog.carlcarl.me/tag/ubuntu.html">ubuntu</a></p>
</footer><!-- /.post-info -->                <p><img alt="recorditnow" src="http://i.imgur.com/EQUigGel.png" title="RecordItNow_507" /></p>
<p>最近找了很多類似的軟體，不過有些都弄不起來，不然就是怪怪的囧，後來試了這套組合發現還不錯：recorditnow + ffmpeg，ffmpeg 是核心，recorditnow 是 frontend。</p>
<p>下面是使用教學的影片，可以參考看看：<br />
<a href="http://www.youtube.com/watch?v=dEnZe-qfLWA">http://www.youtube.com/watch?v=dEnZe-qfLWA</a></p>
<p>不過我直接下 recorditnow 執行 ffmpeg 選項會有沒辦法停止的問題。<br />
<a href="https://bugs.launchpad.net/ubuntu/+source/recorditnow/+bug/858973">https://bugs.launchpad.net/ubuntu/+source/recorditnow/+bug/858973</a><br />
上面這個連結有提供修正的 PPA<br />
以 ubuntu 來講，執行：</p>
<div class="highlight"><pre>sudo add-apt-repository ppa:ap10336/ppa
sudo apt-get update
sudo apt-get ...</pre></div>
                <a class="readmore" href="http://blog.carlcarl.me/326/ubuntu-desktop-record-recorditnow-ffmpeg/">read more</a>
<p>There are <a href="http://blog.carlcarl.me/326/ubuntu-desktop-record-recorditnow-ffmpeg/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://blog.carlcarl.me/166/98address-already-in-use-make_sock-could-not-bind-to-address-80/" rel="bookmark"
                           title="Permalink to (98)Address already in use: make_sock: could not bind to address 80">(98)Address already in use: make_sock: could not bind to address 80</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2011-12-05T19:37:00">
                一 05 12月 2011
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.carlcarl.me/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="http://blog.carlcarl.me/category/linux.html">linux</a>. </p>
<p>tags: <a href="http://blog.carlcarl.me/tag/fuser.html">fuser</a><a href="http://blog.carlcarl.me/tag/ubuntu.html">ubuntu</a></p>
</footer><!-- /.post-info -->                <p>最近在重開 server 的時候突然發現 apache
怎麼沒有開，重開之後就出現如標題的錯誤，查了一下，應該是有個莫名的
process 把 port 給 bind 住了，用了一堆指令，一直 kill
process，結果怎麼好像都沒用囧，後來才試到一個可以解決的指令：</p>
<div class="highlight"><pre>sudo fuser 80/tcp
</pre></div>


<p>執行之後就會顯示是哪個 process id 佔住的。<br />
很奇怪的是我使用「netstat」去看居然是找不到的=
=，另外要注意的是記得使用「sudo」或者是用 root
來查看，不然有可能會看不到。砍掉之後，再開啟 apache
就可以成功開啟了，算是一個滿怪的問題，當初忙著砍掉，忘記先查看 process
的名稱是什麼，只能先紀錄起來，下次如果還是發生一樣的情況的話，再來看看哩。</p>
<p>參考網址 ...</p>
                <a class="readmore" href="http://blog.carlcarl.me/166/98address-already-in-use-make_sock-could-not-bind-to-address-80/">read more</a>
<p>There are <a href="http://blog.carlcarl.me/166/98address-already-in-use-make_sock-could-not-bind-to-address-80/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://blog.carlcarl.me/49/ubuntu-nautilus-thumbnail/" rel="bookmark"
                           title="Permalink to Ubuntu nautilus video thumbnail">Ubuntu nautilus video thumbnail</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2011-11-03T18:31:00">
                四 03 11月 2011
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://blog.carlcarl.me/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="http://blog.carlcarl.me/category/linux.html">linux</a>. </p>
<p>tags: <a href="http://blog.carlcarl.me/tag/nautilus.html">nautilus</a><a href="http://blog.carlcarl.me/tag/thumbnail.html">thumbnail</a><a href="http://blog.carlcarl.me/tag/ubuntu.html">ubuntu</a></p>
</footer><!-- /.post-info -->                <p>最近發現有些影片的預覽圖一直沒辦法看到，想說會不會是播放器的問題，可是搞了老半天卻還是不行。在查了一些資料之後才發現，這個原因好像是因為在之前偵測某幾個影片預覽圖的時候可能失敗還是怎樣，然後這幾個影片就從此不會再作擷取預覽圖的動作，以下是解決方法：</p>
<div class="highlight"><pre>rm -r ~/.thumbnails/fail/
</pre></div>


<p>刪完之後再重新整理就 OK 哩～。</p>
<p>參考網址：</p>
<p><a href="http://www.ubuntu-tw.org/modules/newbb/viewtopic.php?viewmode=compact&amp;topic_id=9430&amp;forum=4">http://www.ubuntu-tw.org/modules/newbb/viewtopic.php?viewmode=compact&amp;topic_id=9430&amp;forum=4</a></p>
                <a class="readmore" href="http://blog.carlcarl.me/49/ubuntu-nautilus-thumbnail/">read more</a>
<p>There are <a href="http://blog.carlcarl.me/49/ubuntu-nautilus-thumbnail/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'carlcarl';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>