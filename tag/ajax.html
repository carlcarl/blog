<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>carlcarl's blog - ajax</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">carlcarl's blog </a></h1>
                <nav><ul>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/813/ajax-with-mobile-keyboard-go-button/">ajax with mobile keyboard go button</a></h1>
<footer class="post-info">
        <abbr class="published" title="2013-04-07T22:58:00">
                日 07 4月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="/category/js.html">js</a>. </p>
<p>tags: <a href="/tag/ajax.html">ajax</a><a href="/tag/mobile.html">mobile</a></p>
</footer><!-- /.post-info --><p>最近弄 ajax 在手機上測的時候發現按 keyboard 上的 go 按鈕不會自動
submit，所以看了一下是怎麼回事。找了一些資料加上自己測試了一下，發現原來
go 按鈕跟 enter 是一樣的 event。</p>
<p>我最後決定的做法是將原本 ajax 要 submit 的 部分先用 form tag
包起來，ajax 的按鈕則改成 <code>&lt;button type="submit"&gt;&lt;/button&gt;</code>，<code>type</code> 用
<code>submit</code> 可以使得在按 enter 或是 手機上按 go 的時候能 trigger submit 的
event，這邊用 <code>&lt;input&gt;</code> 也是可以，不過因為我有用一些 icon 在按鈕中，用
button tag 相對比較好做。再來就是註冊 form tag 的 event，用 jQuery
來說就是 <code>$('#myform').submit(myfunction);</code>，接著在 <code>myfunction</code>
中記得最後要 <code>return false;</code>，以避免真的 submit 頁面上去。</p>
<p>參考網址：<br />
<a href="http://stackoverflow.com/questions/1960240/jquery-ajax-submit-form">http://stackoverflow.com/questions/1960240/jquery-ajax-submit-form</a></p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/355/ajaxfileupload-syntaxerror-missing-in-xml-expression/" rel="bookmark"
                           title="Permalink to ajaxfileupload SyntaxError: missing } in XML expression">ajaxfileupload SyntaxError: missing } in XML expression</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-04-06T04:39:00">
                五 06 4月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="/category/js.html">js</a>. </p>
<p>tags: <a href="/tag/ajax.html">ajax</a><a href="/tag/ajaxfileupload.html">ajaxfileupload</a></p>
</footer><!-- /.post-info -->                <p>本來用 <a href="http://www.phpletter.com/Our-Projects/AjaxFileUpload/">ajaxfileupload</a>
用得好好的，結果不知道為什麼就突然出現這個錯誤，查了一下資料再加上自己比對的結果才發現，原來是因為我在
server 端的 response 加上 content type="application/json"
的關係，而這個結果導致在 client 這邊的 response 被 <code>&lt;pre&gt;&lt;/pre&gt;</code>
給包了起來，也因此在 parse 的時候出現錯誤。</p>
<p>解決方法有兩種：<br />
1. server 端拿掉 minetype<br />
2. client 端把 response 的 <code>&lt;pre&gt;&lt;/pre&gt;</code> 處理掉。<br />
這邊我是選擇了第2種方法來做，因為我覺得 minetype
這東西是需要加的，現在不加怕以後會有相容性問題。</p>
<p>這邊其實很簡單，只要在 ajaxfileupload.js 中修改 uploadHttpData ...</p>
                <a class="readmore" href="/355/ajaxfileupload-syntaxerror-missing-in-xml-expression/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/342/django-ajax-file-upload/" rel="bookmark"
                           title="Permalink to Django ajax file upload">Django ajax file upload</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-04-03T21:56:00">
                二 03 4月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/carlcarl.html">carlcarl</a>
        </address>
<p>In <a href="/category/js-python.html">js, python</a>. </p>
<p>tags: <a href="/tag/ajax.html">ajax</a><a href="/tag/ajaxfileupload.html">ajaxfileupload</a><a href="/tag/csrf.html">csrf</a><a href="/tag/django.html">django</a><a href="/tag/python.html">python</a></p>
</footer><!-- /.post-info -->                <p>原本以為很簡單可以完成的東西，結果花了我不少時間解決囧。</p>
<p>Ajax 檔案上傳我用的是 <a href="http://www.phpletter.com/Our-Projects/AjaxFileUpload/">ajaxfileupload</a> 這個 jQuery 套件，問題在於
Django 會檢查 csrf 的問題，如果我不在 settings.py 裡的
<code>MIDDLEWARE_CLASSES</code> 加上
<code>django.middleware.csrf.CsrfViewMiddleware</code>，上傳會出現 syntax
error，如果我加上了，則是會跟我說 csrf token 找不到。</p>
<p>後來找到的解決辦法就是在 views.py 裡拿到 csrf token 並傳到 template
中，然後再改寫 ajaxfileupload.js 中的內容，讓它支援傳送參數，接著將 csrf
token 當作參數傳送回去就 OK ...</p>
                <a class="readmore" href="/342/django-ajax-file-upload/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>