<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>carlcarl's blog - linux</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <meta property="og:site_name" content="carlcarl's blog" />
                <meta property="og:type" content="website" />
                <meta property="og:title" content="carlcarl's blog" />
                <meta property="og:url" content="http://blog.carlcarl.me" />
                <meta property="og:description" content="carlcarl's blog" />
            <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/main.css">

    <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/blog.css">
    <link rel="stylesheet" href="http://blog.carlcarl.me/theme/css/github.css">
        <link href="http://blog.carlcarl.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="carlcarl's blog Atom Feed" />
        <script src="http://blog.carlcarl.me/theme/js/vendor/modernizr-2.7.1.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
        <h1><a id="site-title" href="http://blog.carlcarl.me"><i class="fa fa-coffee"></i> carlcarl's blog</a></h1>
        <p id="site-desc"></p>
    <nav>
        <ul id="nav-links">
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-04-15T15:00:00+08:00" pubdate>
                            Wed 15 April 2015
                        </time>
                        <a href="http://blog.carlcarl.me/1423/linux_single_instance_lock/" rel="bookmark"><h1>Linux Single Instance Lock</h1></a>
                    </header>
                    <section class="post-content">
                        <p>要實作 single instance 有幾種方式:</p>
<ul>
<li>file lock</li>
<li>inet socket lock</li>
<li><code>sem_open</code> </li>
</ul>
<p>參照一些 daemon 的作法，感覺 file lock 較常見。inet socket bind 的作法有點麻煩，因爲還要找個 port 來 bind，所以不考慮，unix socket 大略等同於 file lock 的作法，不過步驟太煩雜，所以也不考慮，semaphore(<code>sem_open</code>)的作法看似比較好，因為 lock 是在 kernel 裡做管理，不用另外建 file，不過還是有一些問題在: <a href="https://stackoverflow.com/questions/2053679/how-do-i-recover-a-semaphore-when-the-process-that-decremented-it-to-zero-crashe">How do I recover a ...</a></p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2014-05-14T16:30:00+08:00" pubdate>
                            Wed 14 May 2014
                        </time>
                        <a href="http://blog.carlcarl.me/1395/tcp_tw_recycle_note/" rel="bookmark"><h1>tcp_tw_recycle note</h1></a>
                    </header>
                    <section class="post-content">
                        <h2>簡單結論</h2>
<ul>
<li><code>/proc/sys/net/ipv4/tcp_tw_reuse</code> 可以開。</li>
<li><code>/proc/sys/net/ipv4/tcp_tw_recycle</code> 不應該開。</li>
</ul>
<p>Links:<br />
<a href="http://blog.sina.com.cn/s/blog_781b0c850100znjd.html">tcp_tw_recycle和tcp_timestamps导致connect失败问题</a><br />
<a href="http://www.pagefault.info/?p=416">打开tcp_tw_recycle引起的一个问题</a><br />
<a href="http://stackoverflow.com/questions/6426253/tcp-tw-reuse-vs-tcp-tw-recycle-which-to-use-or-both">tcp_tw_reuse vs tcp_tw_recycle : Which to use (or both)?</a><br />
<a href="http://www.speedguide.net/articles/linux-tweaking-121">Linux Tweaking</a><br />
<a href="http://stackoverflow.com/questions/8893888/dropping-of-connections-with-tcp-tw-recycle">Dropping of connections with tcp_tw_recycle</a>  </p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2014-02-08T02:00:00+08:00" pubdate>
                            Sat 08 February 2014
                        </time>
                        <a href="http://blog.carlcarl.me/1391/check_if_command_exist/" rel="bookmark"><h1>Check if command exist</h1></a>
                    </header>
                    <section class="post-content">
                        <p>本來直覺是用 <code>which</code>，不過查了一下資料，在 <a href="https://stackoverflow.com/questions/592620/how-to-check-if-a-program-exists-from-a-bash-script">How to check if a program exists from a bash script?</a> 發現有幾個不建議用 <code>which</code> 的理由：</p>
<ol>
<li>cost 太大，需要另外 call 一個 process 來處理</li>
<li>exit status 在一些系統並沒有定義</li>
<li>很多 operating system 會對 <code>which</code> 做額外的 tweak，可能會有其他的 side effect</li>
</ol>
<p>在解答中建議可以用 <code>hash</code>, <code>command</code>, <code>type</code> 等指令來判斷，其中 <code>command</code> 的 exit code 在 POSIX ...</p>
                    </section>
                </article>
                <hr/>
            </li>
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2013-04-27T00:23:00+08:00" pubdate>
                            Sat 27 April 2013
                        </time>
                        <a href="http://blog.carlcarl.me/838/linux-kernel-space-get-time-interval/" rel="bookmark"><h1>Linux kernel space get time interval</h1></a>
                    </header>
                    <section class="post-content">
                        <p>之前聽到可以用 <code>jiffies</code>
來抓時間，可是我自己測的結果是前後抓的時間會都一樣囧。查了一下
stackoverflow，也有<a href="http://stackoverflow.com/questions/4655711/measuring-execution-time-of-a-function-inside-linux-kernel">一個遇到一樣的問題</a>，我猜可能 <code>jiffies</code> 也是用
period update 的方式做更新，由於中間測量的 function
太快，導致來不及更新就拿到了一樣的值這樣。而在下面的回答中看到可以用
<code>do_gettimeofday()</code> 來抓時間區間，簡單範例如下：  </p>
<div class="highlight"><pre><span class="cp">#include &lt;linux/time.h&gt;</span>
<span class="c1">// ...</span>
<span class="k">struct</span> <span class="n">timeval</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>

<span class="n">do_gettimeofday</span><span class="p">(</span><span class="o">&amp;</span><span class="n">begin</span><span class="p">);</span>
<span class="c1">// Do something here</span>
<span class="n">do_gettimeofday</span><span class="p">(</span><span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>

<span class="c1">// Get milliseconds </span>
<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">-</span> <span class="n">begin</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
<span class="n">val</span> <span class="o">+=</span> <span class="p">((</span><span class="n">end ...</span></pre></div>
                    </section>
                </article>
                <hr/>
            </li>
        </ol>
        <div class="paginator">
            Page 1 / 1
        </div>

    </div>
        </div>

<script>
    var _gaq=[['_setAccount','UA-24249240-5'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
        <script src="http://blog.carlcarl.me/theme/js/main.js"></script>
    </body>
</html>